prometheus:
  prometheusSpec:
    remoteWrite:
    - url: http://fluentd:9888/prometheus.metrics.state.daemonset
      writeRelabelConfigs:
      - action: keep
        regex: kube-state-metrics;(kube_daemonset_status_current_number_scheduled|kube_daemonset_status_desired_number_scheduled|kube_daemonset_status_number_misscheduled|kube_daemonset_status_number_unavailable|kube_daemonset_metadata_generation)
        sourceLabels: [job, __name__]
    - url: http://fluentd:9888/prometheus.metrics.state.deployment
      writeRelabelConfigs:
      - action: keep
        regex: kube-state-metrics;(kube_deployment_metadata_generation|kube_deployment_spec_paused|kube_deployment_spec_replicas|kube_deployment_status_observed_generation|kube_deployment_spec_strategy_rollingupdate_max_unavailable|kube_deployment_status_replicas_available|kube_deployment_status_replicas_unavailable)
        sourceLabels: [job, __name__]
    - url: http://fluentd:9888/prometheus.metrics.state.node
      writeRelabelConfigs:
      - action: keep
        regex: kube-state-metrics;(kube_node_info|kube_node_spec_unschedulable|kube_node_status_allocatable|kube_node_status_capacity|kube_node_status_condition)
        sourceLabels: [job, __name__]
    - url: http://fluentd:9888/prometheus.metrics.state.pod
      writeRelabelConfigs:
      - action: keep
        regex: kube-state-metrics;(kube_pod_container_info|kube_pod_container_resource_requests|kube_pod_container_resource_limits|kube_pod_container_status_ready|kube_pod_container_status_terminated_reason|kube_pod_container_status_waiting_reason|kube_pod_status_phase)
        sourceLabels: [job, __name__]
    - url: http://fluentd:9888/prometheus.metrics.controller-manager
      writeRelabelConfigs:
      - action: keep
        regex: cloudprovider_.*_api_request_duration_seconds.*
        sourceLabels: [__name__]
    - url: http://fluentd:9888/prometheus.metrics.scheduler
      writeRelabelConfigs:
      - action: keep
        regex: scheduler_e2e_scheduling_latency_microseconds.*|scheduler_binding_latency_microseconds.*|scheduler_scheduling_algorithm_latency_microseconds.*
        sourceLabels: [__name__]
    # api server metrics
    - url: http://fluentd:9888/prometheus.metrics.apiserver
      writeRelabelConfigs:
      - action: keep
        regex: apiserver;apiserver_request_(?:count|latencies.*)
        sourceLabels: [job, __name__]
    - url: http://fluentd:9888/prometheus.metrics.apiserver
      writeRelabelConfigs:
      - action: keep
        regex: apiserver;etcd_request_cache_(?:get|add)_latencies_summary.*
        sourceLabels: [job, __name__]
    # kubelet metrics
    - url: http://fluentd:9888/prometheus.metrics.kubelet
      writeRelabelConfigs:
      - action: keep
        regex: kubelet;kubelet_docker_operations_(?:errors|latency_microseconds.*)
        sourceLabels: [job, __name__]
    - url: http://fluentd:9888/prometheus.metrics.kubelet
      writeRelabelConfigs:
      - action: keep
        regex: kubelet;kubelet_(running_container_count|running_pod_count|runtime_operations_latency_microseconds.*)
        sourceLabels: [job, __name__]
    # cadvisor container metrics
    - url: http://fluentd:9888/prometheus.metrics.container
      writeRelabelConfigs:
      - action: keep
        regex: container_cpu_(?:load_average_10s|(?:system|usage)_seconds_total)
        sourceLabels: [__name__]
    - url: http://fluentd:9888/prometheus.metrics.container
      writeRelabelConfigs:
      - action: keep
        regex: container_memory_(?:usage_bytes|memory_swap)
        sourceLabels: [__name__]
    - url: http://fluentd:9888/prometheus.metrics.container
      writeRelabelConfigs:
      - action: keep
        regex: container_spec_memory_(?:|swap|reservation)_limit_bytes
        sourceLabels: [__name__]
    - url: http://fluentd:9888/prometheus.metrics.container
      writeRelabelConfigs:
      - action: keep
        regex: container_fs_(?:(?:usage|limit)_bytes|(?:reads|writes)_bytes_total)
        sourceLabels: [__name__]
    - url: http://fluentd:9888/prometheus.metrics.container
      writeRelabelConfigs:
      - action: keep
        regex: container_network_(?:receive|transmit)_(?:bytes|errors)_total
        sourceLabels: [__name__]
    # node exporter metrics
    - url: http://fluentd:9888/prometheus.metrics.node
      writeRelabelConfigs:
      - action: keep
        regex: node-exporter;node_load(?:1|5|15)
        sourceLabels: [job, __name__]
    - url: http://fluentd:9888/prometheus.metrics.node
      writeRelabelConfigs:
      - action: keep
        regex: node-exporter;node_cpu_seconds_total
        sourceLabels: [job, __name__]
    - url: http://fluentd:9888/prometheus.metrics.node
      writeRelabelConfigs:
      - action: keep
        regex: node-exporter;node_memory_(?:MemAvailable|MemTotal|Buffers|SwapCached)_bytes
        sourceLabels: [job, __name__]
    - url: http://fluentd:9888/prometheus.metrics.node
      writeRelabelConfigs:
      - action: keep
        regex: node-exporter;node_ipvs_(?:incoming|outgoing)_(?:bytes|packets)_total
        sourceLabels: [job, __name__]
    - url: http://fluentd:9888/prometheus.metrics.node
      writeRelabelConfigs:
      - action: keep
        regex: node-exporter;node_disk_(?:(?:reads|writes)_completed|(?:read|written)_bytes)_total
        sourceLabels: [job, __name__]
    - url: http://fluentd:9888/prometheus.metrics.node
      writeRelabelConfigs:
      - action: keep
        regex: node-exporter;node_filesystem_(?:avail|free|size)_bytes
        sourceLabels: [job, __name__]
    # golang related metrics
    - url: http://fluentd:9888/prometheus.metrics.go
      writeRelabelConfigs:
      - action: keep
        regex: go_gc_duration_seconds|go_threads|go_goroutines
        sourceLabels: [__name__]
